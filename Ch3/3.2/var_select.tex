\subsection{Tiền xử lý bộ số liệu}
Mô hình logit giả định xác suất dự báo  $P(y = 1|X)$  phân phối chuẩn với trung bình là 0,5 và thực hiện ước lượng có hiệu quả hơn trên bộ số liệu có tỉ lệ biến phụ thiộc là 0,5. 
Tuy nhiên trong bộ số liệu chúng ta nghiên cứu này, tỷ lệ  $\texttt{DEFAULT} = 1$ là $22.34\%$.
Để đảm bảo cho hiệu quả của mô hình logit, trong bộ số liệu dùng để ước lượng mô hình, chúng ta lấy tập con của số mẫu thuộc nhóm $\texttt{DEFAULT} = 1$ một cách ngẫu nhiên, sao cho tỷ lệ  $P(\texttt{DEFAULT} = 1)$ trong bộ số liệu ước lượng bây giờ là 0,5. 

\subsection{Ước lượng mô hình} 
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{lasso_fit} \hlkwb{<-}\hlkwd{glmnet}\hlstd{(train_x_matrix}\hlopt{$}\hlstd{x, train_x_matrix}\hlopt{$}\hlstd{y,}
                   \hlkwc{family} \hlstd{=} \hlstr{"binomial"}\hlstd{,} \hlkwc{alpha} \hlstd{=} \hlnum{1}\hlstd{)}
\end{alltt}


{\ttfamily\noindent\bfseries\color{errorcolor}{\#\# Error in eval(expr, envir, enclos): could not find function "{}glmnet"{}}}\begin{alltt}
\hlstd{lasso_cv} \hlkwb{<-} \hlkwd{cv.glmnet}\hlstd{(train_x_matrix}\hlopt{$}\hlstd{x, train_x_matrix}\hlopt{$}\hlstd{y,}
                      \hlkwc{family} \hlstd{=} \hlstr{"binomial"}\hlstd{,} \hlkwc{alpha} \hlstd{=} \hlnum{1}\hlstd{)}
\end{alltt}


{\ttfamily\noindent\bfseries\color{errorcolor}{\#\# Error in eval(expr, envir, enclos): could not find function "{}cv.glmnet"{}}}\end{kframe}
\end{knitrout}

Chúng ta thực hiện mô hình logit, sử dụng phương pháp Lasso để giới hạn giá trị của các hệ số ước lượng. 
Với mỗi gía trị của tham số $\lambda$, giá trị của các hệ số ước lượng $\beta$ càng bị ràng buộc chặt, các hệ số ước lượng có giá trị bằng 0 có thể coi là bị loại khỏi mô hình.

\begin{figure}[h]
\centering
\capstart
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{lasso_fit}\hlopt{$}\hlstd{beta} \hlopt{%>%} \hlkwd{as.matrix}\hlstd{()} \hlopt{%>%} \hlkwd{t}\hlstd{()} \hlopt{%>%} \hlkwd{as.data.frame}\hlstd{()} \hlopt{%>%}
  \hlkwd{mutate}\hlstd{(}\hlkwc{lambda} \hlstd{= lasso_fit}\hlopt{$}\hlstd{lambda)} \hlopt{%>%}
  \hlkwd{gather}\hlstd{(Varname, Beta,} \hlkwd{everything}\hlstd{(),} \hlopt{-}\hlstd{lambda)} \hlopt{%>%}
  \hlkwd{ggplot}\hlstd{(}\hlkwd{aes}\hlstd{(}\hlkwc{x} \hlstd{= lambda,} \hlkwc{y} \hlstd{= Beta,} \hlkwc{group} \hlstd{= Varname))} \hlopt{+}
  \hlkwd{geom_line}\hlstd{(}\hlkwd{aes}\hlstd{(}\hlkwc{color} \hlstd{= Varname))} \hlopt{+}
  \hlkwd{labs}\hlstd{(}\hlkwc{x} \hlstd{= latex2exp}\hlopt{::}\hlkwd{TeX}\hlstd{(}\hlstr{"Giá trị của $\textbackslash{}\textbackslash{}log(\textbackslash{}\textbackslash{}lambda)$"}\hlstd{),}
       \hlkwc{y} \hlstd{=} \hlstr{"Hệ số ước lượng"}\hlstd{,} \hlkwc{color} \hlstd{=} \hlstr{"Biến"}\hlstd{)} \hlopt{+}
  \hlkwd{theme}\hlstd{(}\hlkwc{legend.position} \hlstd{=} \hlstr{"top"}\hlstd{)}
\end{alltt}


{\ttfamily\noindent\bfseries\color{errorcolor}{\#\# Error in eval(expr, envir, enclos): could not find function "{}\%>\%"{}}}\end{kframe}
\end{knitrout}
\caption{}
\label{fig:lasso_coef}
\end{figure}

Hình \ref{fig:lasso_coef} mô tả xu hướng của các hệ số ước lượng $\beta$ khi giá trị của $\log\lambda$ thay đổi.
Với hướng tăng của $\log\lambda$ các biến thuộc nhóm \texttt{BILL} nhanh chóng hội tụ về $0$, thể hiện mức ý nghĩa thống kê thấp của các hệ số này trong mô hình. Trong khi đó, các biến thuộc nhóm \texttt{PAY} chậm hội tụ về $0$ hơn, với biến \texttt{PAY\_0} là biến cuối cùng có hệ số ước lượng $\beta$ tương ứng hội tụ về 0.
Với các giá trị $\lambda$ lớn hơn từ sau thời điểm này, có thể nói mô hình chỉ còn hệ số chặn $\beta_0$.

Để xác định giá trị hợp lý cho tham số $\lambda$ trong mô hình này. Chúng ta thực hiện bằng cách chia bộ số liệu thử nghiệm thành 10 phần nhỏ, chạy mô hình logit sử dụng phương pháp Lasso này trên từng bộ số liệu con này, rồi kiểm định kết quả mô hình dựa trên các bộ số liệu còn lại.
Từ kết quả của 10 phép ước lượng kiểm định chéo này, chúng ta có thể tính được giá trị trung bình của Deviance tại các giá trị của $\lambda$, qua đó chúng ta có thể xác định được giá trị của $\lambda$ mà Deviance là thấp nhất.

\begin{figure}
\centering
\capstart
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlkwd{do.call}\hlstd{(data.frame, lasso_cv[}\hlnum{1}\hlopt{:}\hlnum{6}\hlstd{])} \hlopt{%>%}
  \hlkwd{ggplot}\hlstd{(}\hlkwd{aes}\hlstd{(}\hlkwc{x} \hlstd{=} \hlkwd{log}\hlstd{(lambda),} \hlkwc{y} \hlstd{= cvm))} \hlopt{+}
  \hlkwd{geom_vline}\hlstd{(}\hlkwc{xintercept} \hlstd{=} \hlkwd{log}\hlstd{(lasso_cv}\hlopt{$}\hlstd{lambda.min),}
             \hlkwc{color} \hlstd{=} \hlstr{"darkblue"}\hlstd{)} \hlopt{+}
  \hlkwd{geom_errorbar}\hlstd{(}\hlkwd{aes}\hlstd{(}\hlkwc{ymax} \hlstd{= cvup,} \hlkwc{ymin} \hlstd{= cvlo))} \hlopt{+}
  \hlkwd{geom_point}\hlstd{(}\hlkwc{color} \hlstd{=} \hlstr{"red"}\hlstd{)} \hlopt{+}
  \hlkwd{labs}\hlstd{(}\hlkwc{y} \hlstd{=} \hlstr{"Deviance trung bình của kiểm định chéo"}\hlstd{,}
       \hlkwc{x} \hlstd{= latex2exp}\hlopt{::}\hlkwd{TeX}\hlstd{(}\hlstr{"$\textbackslash{}\textbackslash{}log(\textbackslash{}\textbackslash{}lambda)$"}\hlstd{))}
\end{alltt}


{\ttfamily\noindent\bfseries\color{errorcolor}{\#\# Error in eval(expr, envir, enclos): could not find function "{}\%>\%"{}}}\end{kframe}
\end{knitrout}





